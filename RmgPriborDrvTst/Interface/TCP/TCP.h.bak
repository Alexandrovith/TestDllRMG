///@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

///~~~~~~~~~	Проект:			Driver EC605
///~~~~~~~~~	Прибор:			EC605
///~~~~~~~~~	Модуль:			Обмен с прибором по TCP/IP
///~~~~~~~~~	Разработка:	Демешкевич С.А.
///~~~~~~~~~	Дата:				26.07.2018

///@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

#pragma once

#include <winsock2.h>
#include "Connect.h"

class CTCP : public IConnect
{
public:
	static const int LEN_MAX = 512;				// код ошибки и размер буферов

private:
	std::string asIP;
	USHORT usPort;
	WSADATA wsaData;
	SOCKET Socket;  // впускающий сокет и сокет для клиентов


public:
	CTCP (/*void* Owner, */std::string IP, USHORT Port/*, CMessages *Message*/);
	~CTCP ();
	virtual bool Opening ();
	virtual bool OpenPort ();
	virtual bool ClosePort ();
private:
	void OutMessErr (const std::string cpPrefix);
	void OutMess (const std::string cpMess);
public:

	// Аварийное закрытие соединения
	void CloseErr ();
	std::string IP_Port ();
	virtual bool Send (char *cpBufTX, int iSize);
	virtual int Recieve (char* cpBufRX, int iMaxSizeRX, int& iCountBites, std::string asEnd = "da");
private:
public:

	bool IsConnected ()
	{
		return bConnected;
	}
};

